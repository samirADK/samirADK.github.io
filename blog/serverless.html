<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://img.icons8.com/ios-filled/50/000000/infinity.png" type="image/png">

    <title>Developing a Secure, Scalable, Serverless OTP Service - Samir Adhikari</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NQYZ1YTN96"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NQYZ1YTN96');
</script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap');

        /* Light Theme Variables (Copied from Landing Page) */
        :root {
            --bg-primary: #f8f8f8;
            --bg-secondary: #ffffff;
            --bg-accent: #f0f0f0;
            --text-primary: #222222;
            --text-secondary: #555555;
            --accent-color: #6e56cf;
            --accent-hover: #8a6eff;
            --accent-muted: rgba(110, 86, 207, 0.2);
            --gradient-1: linear-gradient(135deg, #6e56cf 0%, #b86eff 100%);
            --gradient-2: linear-gradient(135deg, #f0f0f0 0%, #ffffff 100%);
            --shadow-sm: 0 5px 15px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.2);
            --shadow-glow: 0 0 15px rgba(110, 86, 207, 0.2);
            --card-border: 1px solid #e0e0e0;
            --neon-glow: 0 0 10px rgba(110, 86, 207, 0.3), 0 0 20px rgba(110, 86, 207, 0.1);
            --header-bg: rgba(255, 255, 255, 0.9);
            --switch-bg: #e0e0e0;
            --switch-thumb: #ffffff;
            --switch-icon-color: #6e56cf;
            --footer-divider: #e0e0e0;
            --scrollbar-track: #f0f0f0;
            --scrollbar-thumb: #cccccc;
            --code-bg: #e9e9e9; /* Specific for light theme code blocks */
        }

        /* Dark Theme Variables (Copied from Landing Page) */
        :root[data-theme="dark"] {
            --bg-primary: #0f0f0f;
            --bg-secondary: #161616;
            --bg-accent: #1e1e1e;
            --text-primary: #f8f8f8;
            --text-secondary: #bebebe;
            --accent-color: #6e56cf;
            --accent-hover: #8a6eff;
            --accent-muted: rgba(110, 86, 207, 0.3);
            --gradient-1: linear-gradient(135deg, #6e56cf 0%, #b86eff 100%);
            --gradient-2: linear-gradient(135deg, #1e1e1e 0%, #3b3b3b 100%);
            --shadow-sm: 0 5px 15px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.4);
            --shadow-glow: 0 0 15px rgba(110, 86, 207, 0.4);
            --card-border: 1px solid #2a2a2a;
            --neon-glow: 0 0 10px rgba(110, 86, 207, 0.5), 0 0 20px rgba(110, 86, 207, 0.3);
            --header-bg: rgba(15, 15, 15, 0.9);
            --switch-bg: #333333;
            --switch-thumb: #6e56cf;
            --switch-icon-color: #ffffff;
            --footer-divider: #2a2a2a;
            --scrollbar-track: #161616;
            --scrollbar-thumb: #333333;
            --code-bg: #232323; /* Specific for dark theme code blocks */
        }

        /* General Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        h1, h2, h3, h4, h5 {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            color: var(--text-primary); /* Ensure headings also transition color */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background-color: var(--header-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0 20px;
            border-bottom: var(--card-border);
            transition: background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: color 0.5s ease;
        }

        .logo::before {
            content: "";
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 10px;
            background-color: var(--accent-color);
            border-radius: 50%;
            box-shadow: var(--shadow-glow);
            transition: background-color 0.5s ease, box-shadow 0.5s ease;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 40px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 16px;
            transition: all 0.3s;
            position: relative;
        }

        .nav-links a::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--accent-color);
            transition: width 0.3s;
        }

        .nav-links a:hover {
            color: var(--accent-color);
            text-shadow: var(--neon-glow);
        }

        .nav-links a:hover::after {
            width: 100%;
            box-shadow: var(--shadow-glow);
        }

        /* Theme Switch (Copied from Landing Page) */
        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            margin-left: 30px;
            position: relative;
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 32px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--switch-bg);
            transition: .4s;
            border-radius: 34px;
            overflow: hidden;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background-color: var(--switch-thumb);
            transition: .4s;
            border-radius: 50%;
            z-index: 2;
        }

        .slider .switch-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
            color: var(--switch-icon-color);
            transition: opacity 0.3s, transform 0.5s;
        }

        .slider .sun-icon {
            right: 9px;
            opacity: 1;
        }

        .slider .moon-icon {
            left: 7px;
            opacity: 0;
        }

        input:checked + .slider .sun-icon {
            opacity: 0;
        }

        input:checked + .slider .moon-icon {
            opacity: 1;
        }

        input:checked + .slider {
            background-color: var(--accent-color);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--accent-color);
        }

        input:checked + .slider:before {
            transform: translateX(28px);
            background-color: var(--accent-color); /* Ensure thumb is accent color when checked dark */
        }
        :root[data-theme="dark"] .slider:before { /* Light theme thumb on dark bg */
             /* background-color: #ffffff; /* Default thumb for light mode is white */
        }
        :root[data-theme="dark"] input:checked + .slider:before { /* Dark theme thumb on dark bg, when checked */
            background-color: var(--switch-thumb); /* Uses dark theme switch thumb */
        }


        /* Blog Post Styles */
        .blog-post {
            padding: 80px 0;
        }

        .blog-post-title {
            font-size: 42px;
            margin-bottom: 30px;
            text-align: center;
            color: var(--text-primary);
            transition: color 0.5s ease;
        }

        .blog-post-meta {
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 40px;
            transition: color 0.5s ease;
            flex-wrap: wrap; /* For better responsiveness */
        }

        .blog-post-meta span {
            margin: 5px 15px; /* Adjusted margin for wrapping */
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .blog-post-meta i {
            color: var(--accent-color);
        }

        .blog-post-image {
            max-width: 800px;
            margin: 0 auto 20px; /* Reduced bottom margin */
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .blog-post-image img {
            width: 100%;
            display: block;
            cursor: pointer;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .blog-post-image img:hover {
            transform: scale(1.02);
            opacity: 0.9;
        }
        .blog-post-caption {
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-style: italic;
        }

        .blog-post-content {
            max-width: 800px;
            margin: 0 auto;
            font-size: 18px;
            line-height: 1.8;
            color: var(--text-primary);
            transition: color 0.5s ease;
        }

        .blog-post-content h2 {
            font-size: 32px;
            margin: 40px 0 20px;
            border-bottom: 2px solid var(--accent-muted);
            padding-bottom: 10px;
        }

        .blog-post-content h3 {
            font-size: 26px;
            margin: 30px 0 15px;
        }
         .blog-post-content h4 { /* For sub-sub-headings like filenames */
            font-size: 20px;
            margin: 25px 0 10px;
            color: var(--text-secondary);
            font-weight: 600;
        }


        .blog-post-content p {
            margin-bottom: 25px;
        }

        .blog-post-content ul,
        .blog-post-content ol {
            padding-left: 30px;
            margin-bottom: 25px;
        }

        .blog-post-content li {
            margin-bottom: 10px;
        }

        .blog-post-content a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color 0.3s;
        }

        .blog-post-content a:hover {
            color: var(--accent-hover);
        }

        .blog-post-content blockquote {
            border-left: 5px solid var(--accent-color);
            padding: 15px 20px;
            margin: 30px 0;
            background-color: var(--bg-accent);
            border-radius: 5px;
            font-style: italic;
            color: var(--text-secondary);
            transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }

        /* Code Block Styling */
        .blog-post-content pre {
            background-color: var(--code-bg); /* Use theme-specific bg for code */
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto; /* Enables horizontal scroll */
            margin: 30px 0;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 15px;
            line-height: 1.6;
            white-space: pre; /* Preserves whitespace and formatting */
            box-shadow: var(--shadow-sm);
            transition: background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
        }

        .blog-post-content pre code {
            font-family: inherit;
            color: var(--text-primary); /* Code text color */
            background: none;
            padding: 0;
            font-size: inherit;
            white-space: pre; /* Ensure pre-wrap is not inherited if set on code */
        }
        /* Inline code styling */
        .blog-post-content p > code,
        .blog-post-content li > code,
        .blog-post-content h3 > code,
        .blog-post-content h4 > code {
            background-color: var(--accent-muted);
            color: var(--accent-color);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-size: 0.85em;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
        }


         /*Mobile Menu */
         .mobile-menu-btn {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            margin-left: 20px;
        }

        .mobile-menu-btn span {
            height: 2px;
            width: 100%;
            background-color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .mobile-menu {
            position: fixed;
            top: 80px; /* Adjust based on header height */
            left: 0;
            width: 100%;
            height: 0;
            background-color: var(--bg-secondary);
            overflow: hidden;
            transition: height 0.3s ease, opacity 0.3s ease;
            z-index: 99;
            opacity: 0;
            border-bottom: 1px solid transparent; /* Add border for transition */
        }

        .mobile-menu.active {
            height: auto; /* Or a max-height if preferred */
            opacity: 1;
            box-shadow: var(--shadow-md);
            border-bottom-color: var(--card-border);
        }


        .mobile-menu ul {
            list-style: none;
            padding: 20px;
        }

        .mobile-menu li {
            margin: 15px 0;
        }

        .mobile-menu a {
            font-size: 18px;
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.3s;
            display: block;
            padding: 10px 0;
        }

        .mobile-menu a:hover {
            color: var(--accent-color);
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
            }
             .nav-links { /* Hide desktop nav links on mobile */
                display: none;
            }
             .theme-switch-wrapper { /* Adjust theme switch position or hide on very small screens if needed */
                margin-left: auto; /* Push to right if mobile menu button is also present */
             }
        }

        /* Footer */
        footer {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            padding: 80px 0 40px;
            transition: background-color 0.5s ease, color 0.5s ease;
            border-top: 1px solid var(--footer-divider); /* Added top border */
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 50px;
            flex-wrap: wrap; /* Allow wrapping */
        }

        .footer-logo {
            flex: 1 1 300px; /* Flex basis for responsiveness */
            margin-right: 20px; /* Spacing */
            margin-bottom: 30px;
        }

        .footer-logo h3 {
            font-size: 28px;
            margin-bottom: 20px;
            color: var(--text-primary);
            transition: color 0.5s ease;
        }

        .footer-logo p {
            color: var(--text-secondary);
            margin-bottom: 25px;
            font-size: 15px;
            transition: color 0.5s ease;
        }

        .footer-links {
            flex: 1 1 180px; /* Flex basis for responsiveness */
            margin-bottom: 30px; /* Spacing for wrapped items */
        }

        .footer-links h4 {
            font-size: 20px;
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 12px;
            color: var(--text-primary);
            transition: color 0.5s ease;
        }

        .footer-links h4::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: var(--accent-color);
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--accent-color);
        }

        .footer-divider {
            height: 1px;
            background-color: var(--footer-divider);
            margin: 20px 0;
            transition: background-color 0.5s ease;
        }

        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping for bottom items */
        }

        .copyright {
            color: var(--text-secondary);
            font-size: 14px;
            transition: color 0.5s ease;
            margin-bottom: 10px; /* Spacing when wrapped */
        }

        .footer-social {
            display: flex;
            gap: 15px;
        }

        .footer-social a {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-accent);
            border-radius: 50%;
            border: var(--card-border);
            color: var(--text-secondary);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .footer-social a:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--accent-color);
            border-radius: 50%;
            transform: scale(0);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1; /* Ensure it's above icon if icon not z-indexed */
        }

        .footer-social a:hover {
            color: white;
            transform: translateY(-3px);
            box-shadow: var(--shadow-glow);
            border-color: var(--accent-color);
        }

        .footer-social a:hover:before {
            transform: scale(1);
        }

        .footer-social a i {
            position: relative;
            z-index: 2; /* Ensure icon is above the :before pseudo-element */
        }
         /* Back to top button */
         .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all 0.3s, opacity 0.5s, transform 0.5s;
            z-index: 99;
            opacity: 0;
            transform: translateY(20px);
        }

        .back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .back-to-top:hover {
            background-color: var(--accent-hover);
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--shadow-glow);
        }
         /* Theme transition overlay */
         .theme-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-primary); /* Will be current theme's bg */
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease; /* Faster transition */
        }
         /* Custom scrollbar */
         ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 6px;
            border: 3px solid var(--scrollbar-track);
            transition: background-color 0.5s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }

        /* Prefers color scheme media query - Fallback if JS is disabled or no explicit theme is set */
        @media (prefers-color-scheme: dark) {
            body:not([data-theme="light"]):not([data-theme-forced="light"]) { /* Apply if not explicitly light */
                --bg-primary: #0f0f0f;
                --bg-secondary: #161616;
                --bg-accent: #1e1e1e;
                --text-primary: #f8f8f8;
                --text-secondary: #bebebe;
                --shadow-glow: 0 0 15px rgba(110, 86, 207, 0.4);
                --card-border: 1px solid #2a2a2a;
                --neon-glow: 0 0 10px rgba(110, 86, 207, 0.5), 0 0 20px rgba(110, 86, 207, 0.3);
                --header-bg: rgba(15, 15, 15, 0.9);
                --switch-bg: #333333;
                --switch-thumb: #6e56cf; /* Thumb color in dark mode when switch is "on" (dark selected) */
                --switch-icon-color: #ffffff;
                --footer-divider: #2a2a2a;
                --scrollbar-track: #161616;
                --scrollbar-thumb: #333333;
                --code-bg: #232323;
            }
        }

         /* Responsive Design */
         @media (max-width: 992px) {
            .footer-content {
                gap: 30px; /* Adjust gap for better layout */
            }
         }

        @media (max-width: 768px) {
            .footer-bottom {
                flex-direction: column;
                gap: 20px;
                align-items: center; /* Center items when stacked */
            }
            .blog-post-title {
                font-size: 36px;
            }
            .blog-post-content h2 {
                font-size: 28px;
            }
            .blog-post-content h3 {
                font-size: 22px;
            }
        }
        @media (max-width: 576px) {
            .blog-post-meta span {
                margin: 5px 10px; /* Further reduce margin on very small screens */
            }
            .blog-post-title {
                font-size: 30px;
            }
        }
        
        /* Lightbox Modal Styles */
        .lightbox-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .lightbox-modal.active {
            display: flex;
        }
        
        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            animation: zoomIn 0.3s ease;
        }
        
        .lightbox-content img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            z-index: 10000;
        }
        
        .lightbox-close:hover,
        .lightbox-close:focus {
            color: var(--accent-color);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes zoomIn {
            from { transform: scale(0.8); }
            to { transform: scale(1); }
        }
    </style>
</head>
<body data-theme="light"> <!-- Default to light, JS will handle stored preference -->

    <!-- Theme transition overlay -->
    <div class="theme-transition-overlay" id="themeOverlay"></div>

    <!-- Header -->
    <header>
        <div class="container">
            <nav>
                <a href="/" class="logo">Samir Adhikari</a>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/blog.html">Blog</a></li>
                </ul>
                <!-- Theme Switch (Commented out as per your example) -->
              
                <!-- Mobile Menu Button -->
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu" aria-expanded="false">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Mobile Menu -->
     <div class="mobile-menu" id="mobileMenu">
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/blog.html">Blog</a></li>
            <!-- Mobile theme switch can be added here if desired -->
        </ul>
    </div>

    <!-- Blog Post Section -->
    <section class="blog-post">
        <div class="container">
            <h1 class="blog-post-title">Developing a Secure, Scalable, Serverless OTP Service Using AWS SNS, Lambda, and DynamoDB</h1>
            <div class="blog-post-meta">
                <span><i class="far fa-calendar-alt"></i> May 13, 2025</span>
                <span><i class="far fa-user"></i> Samir Adhikari</span>
                <span><i class="far fa-clock"></i> 7 min read</span>
                <span><i class="far fa-comment"></i> 2 Comments</span>
            </div>

            <div class="blog-post-image">
                <!-- NOTE: Replace with your actual image path -->
                <img src="../img/otp generation.png" alt="OTP Service Architecture Diagram">
            </div>
            <p class="blog-post-caption">Fig: Architecture Diagram For OTP Service</p>

            <div class="blog-post-content">
                <p>We will develop a serverless One-Time Password (OTP) system on AWS and we will code the entire set-up using Terraform. It is simply configured: we send a code in SMS with the help of Amazon SNS, and we check it with the record in DynamoDB.</p>

                <h2>A Quick Look at Serverless</h2>
                <p>Firstly, we should understand the reason of doing the serverless way before we dive into the code.</p>
                
                <p>Serverless does not imply the absence of servers, as the name implies. It simply means that you do not have to contend with them. AWS manages the equipment, revision and capacity planning. You just write the code.</p>
                
                <p><strong>Why it works for us:</strong></p>
                <ul>
                    <li><strong>No Ops:</strong> You do not need to patch an OS and deal with fleets of EC2 instances.</li>
                    <li><strong>Auto-Scaling:</strong> You can have five or five thousand users, and AWS balances automatically.</li>
                    <li><strong>Cost:</strong> This is the biggest win. You only get billed when the code is running. In case there is no one requesting an OTP then you have no bill.</li>
                </ul>
                
                <h2>Why Lambda is the Right Fit</h2>
                <p>The AWS Lambda is ideal in an OTP service due to traffic dynamics. OTP requests are sporadic typically, you may receive a bunch of them at 9:00 AM and none at 3:00 AM.</p>
                
                <p>And by the time you rented a traditional server, you would be renting it to just sit there 90 percent of the time. In the case of Lambda, the function is initiated when a request is sent to the API, executes the logic in some milliseconds and terminates. You will be charged that one-second of compute time. It also works well with API Gateway and DynamoDB which are out-of-the-box compatible and hence there is less glue code to be written.</p>

                <h2>The Stack</h2>
                <p>The following are the particular pieces we are using:</p>
                <ul>
                    <li><strong>API Gateway:</strong> The front door. It provides us with our <code>/send-otp</code> and <code>/verify-otp</code>.</li>
                    <li><strong>AWS Lambda:</strong> The brain. It executes the logic to produce the numbers and test them.</li>
                    <li><strong>Amazon DynamoDB:</strong> The memory. Here we save the OTP with Time to Live (TTL) such that it will automatically expire after several minutes.</li>
                    <li><strong>Amazon SNS:</strong> The shipping service. This really transmits the SMS to the user.</li>
                    <li><strong>Terraform:</strong> The blueprint. We are using this to create the entire environment to not have to be clicking over the AWS console manually.</li>
                </ul>

                <h2>How the Request Flows</h2>
                <p>To picture the way this works in practice:</p>

                <h4>Send OTP Flow</h4>
                <pre><code>┌──────────┐        ┌──────────────┐        ┌─────────────┐        ┌──────────┐        ┌─────────┐
│  Client  │───1───▶│ API Gateway  │───2───▶│   Lambda    │───3───▶│ DynamoDB │        │   SNS   │
│  (User)  │        │  /send-otp   │        │  send_otp   │        │  (Store) │        │ (SMS)   │
└──────────┘        └──────────────┘        └─────────────┘        └──────────┘        └─────────┘
     ▲                                              │                                          │
     │                                              └──────────────4──────────────────────────┘
     │                                                                                         │
     └──────────────────────────5: Success Response◀─────────────────────────────────────────┘

Flow Steps:
1. User sends POST request with phone number to /send-otp
2. API Gateway triggers send_otp Lambda function
3. Lambda generates 6-digit OTP and stores in DynamoDB with 5-min TTL
4. Lambda sends OTP via SNS to user's phone number
5. Success response returned to client</code></pre>

                <h4>Verify OTP Flow</h4>
                <pre><code>┌──────────┐        ┌──────────────┐        ┌─────────────┐        ┌──────────┐
│  Client  │───1───▶│ API Gateway  │───2───▶│   Lambda    │───3───▶│ DynamoDB │
│  (User)  │        │ /verify-otp  │        │ verify_otp  │        │  (Read)  │
└──────────┘        └──────────────┘        └─────────────┘        └──────────┘
     ▲                                              │                      │
     │                                              └──────4───────────────┘
     │                                              │
     │                                        [Validation]
     │                                        • OTP exists?
     │                                        • Not expired?
     │                                        • Matches input?
     │                                              │
     └──────────5: Verified True/False◀─────────────┘

Flow Steps:
1. User sends POST request with phone number and OTP to /verify-otp
2. API Gateway triggers verify_otp Lambda function
3. Lambda retrieves stored OTP from DynamoDB by userId
4. Lambda validates: existence, expiration time, OTP match
5. Response indicates verification success or specific failure reason</code></pre>

                <h3>Component Interaction Details</h3>
                <p>This section is a description of the interactions among the components that form the entire system.</p>
                <ul>
                    <li><strong>API Gateway:</strong> This is the access point which processes the termination of HTTPS, routing of requests, and throttling.</li>
                    <li><strong>Lambda Functions:</strong> Stateless execution environment which is scaled automatically with incoming requests.</li>
                    <li><strong>DynamoDB:</strong> Non-relational database that has automatic TTL deletion of expired OTPs which maintains a constant latency of single digits of milliseconds.</li>
                    <li><strong>SNS:</strong> Trusted SMS delivery platform that covers 200 plus countries with inbuilt retries.</li>
                    <li><strong>IAM Roles:</strong> Least-privilege access which guarantees that Lambda can access only what is necessary.</li>
                </ul>

                <h2>Prerequisites</h2>
                <ul>
                    <li>AWS Account</li>
                    <li>Terraform installed (>= 1.0.0)</li>
                    <li>AWS CLI configured</li>
                    <li>Basic knowledge of AWS services and Python</li>
                </ul>

                <h2>Project Structure</h2>
                <p>Your project should be organized as follows:</p>
<pre><code>.
├── main.tf
├── variables.tf
├── outputs.tf
├── lambda/
│   ├── send_otp.py
│   └── verify_otp.py
└── lambda.zip  (Generated from lambda/ directory)</code></pre>

                <h2>Step-by-Step Implementation</h2>

                <div class="blog-post-image">
                    <img src="../img/aws-lambda-console.png" alt="AWS Lambda Console - Accessing Lambda from AWS Management Console">
                </div>
                <p class="blog-post-caption">Accessing AWS Lambda from the AWS Management Console - Search for "Lambda" in the services search bar to navigate to the Lambda dashboard where you can create and manage your functions.</p>

                <h3>Step 1: Write Lambda Functions</h3>
                <p>Write the Python scripts of your Lambda functions in the directory called <code>lambda</code>.</p>
                
                <p>The OTP service is based on our Lambda functions as the main business logic. The <code>send_otp.py</code> application obtains a 6-digit OTP by generating a number randomly and storing it in DynamoDB with an expiry date and transmitting it through SMS. The <code>verify_otp.py</code> feature authenticates the OTPs entered by users and compares them with the stored OTPs and verifies expiration.</p>

                <h4><code>lambda/send_otp.py</code></h4>
                <p><strong>Description of the Function:</strong> This is the OTP generation and delivery function. It is fed a phone number, creates a random OTP, which is secure, and with a TTL (Time To Live) of 5 minutes, it is placed in DynamoDB and sent through Amazon SNS. The role will cover all aspects of error management related to JSON parsing, parameter omissions, and service errors of the Amazon.</p>
<pre><code class="language-python">
import json
import boto3
import random
import time
import os

dynamodb = boto3.resource('dynamodb')
sns = boto3.client('sns')
# Ensure OTP_TABLE environment variable is set in Lambda configuration
table_name = os.environ.get('OTP_TABLE')
if not table_name:
    raise ValueError("Missing OTP_TABLE environment variable")
table = dynamodb.Table(table_name)

def lambda_handler(event, context):
    try:
        body = json.loads(event.get('body', '{}'))
    except json.JSONDecodeError:
        return {
            'statusCode': 400,
            'body': json.dumps({'error': 'Invalid JSON in request body'})
        }

    user_id = body.get('userId') # Phone number for SMS
    if not user_id:
        return {
            'statusCode': 400,
            'body': json.dumps({'error': 'userId (phone number) is required'})
        }

    otp = str(random.randint(100000, 999999))
    # TTL for 5 minutes (300 seconds)
    # DynamoDB TTL attribute must be a Unix epoch timestamp in seconds
    ttl_timestamp = int(time.time()) + 300

    try:
        table.put_item(Item={
            'userId': user_id,
            'otp': otp,
            'expirationTime': ttl_timestamp  # Ensure this matches TTL attribute in DynamoDB
        })

        sns.publish(
            PhoneNumber=user_id,
            Message=f"Your OTP is: {otp}"
        )
    except Exception as e:
        print(f"Error processing OTP: {e}") # Log error for debugging
        return {
            'statusCode': 500,
            'body': json.dumps({'error': 'Failed to send OTP', 'details': str(e)})
        }

    return {
        'statusCode': 200,
        'body': json.dumps({'message': 'OTP sent successfully'})
    }
</code></pre>

                <h4><code>lambda/verify_otp.py</code></h4>
                <p><strong>Function Overview:</strong>  This is a validation OTP submission. It retrieves the stored OTP in DynamoDB as assistance of the userId, whether it has not expired and compares the given OTP by the user and gives the appropriate success / failure notification. The function uses appropriate codes of the status of an HTTP (404-not found, 410- expired, 401- invalid) to give information on the different situations of failures.</p>
<pre><code class="language-python">
import json
import boto3
import time
import os

dynamodb = boto3.resource('dynamodb')
# Ensure OTP_TABLE environment variable is set in Lambda configuration
table_name = os.environ.get('OTP_TABLE')
if not table_name:
    raise ValueError("Missing OTP_TABLE environment variable")
table = dynamodb.Table(table_name)

def lambda_handler(event, context):
    try:
        body = json.loads(event.get('body', '{}'))
    except json.JSONDecodeError:
        return {
            'statusCode': 400,
            'body': json.dumps({'verified': False, 'error': 'Invalid JSON in request body'})
        }

    user_id = body.get('userId')
    input_otp = body.get('otp')

    if not user_id or not input_otp:
        return {
            'statusCode': 400,
            'body': json.dumps({'verified': False, 'error': 'userId and otp are required'})
        }

    try:
        response = table.get_item(Key={'userId': user_id})
    except Exception as e:
        print(f"Error fetching OTP from DynamoDB: {e}")
        return {
            'statusCode': 500,
            'body': json.dumps({'verified': False, 'error': 'Failed to retrieve OTP details', 'details': str(e)})
        }
        
    item = response.get('Item')

    if not item:
        return {
            'statusCode': 404,
            'body': json.dumps({'verified': False, 'error': 'OTP not found or already used'})
        }

    # Check if OTP has expired - DynamoDB TTL should handle deletion,
    # but this is a good safeguard if item hasn't been reaped yet.
    # 'expirationTime' is expected to be a Unix epoch timestamp in seconds.
    if int(time.time()) > item.get('expirationTime', 0):
        # Optionally, delete the expired item here if not relying solely on TTL
        # table.delete_item(Key={'userId': user_id})
        return {
            'statusCode': 410, # HTTP 410 Gone
            'body': json.dumps({'verified': False, 'error': 'OTP expired'})
        }

    if item.get('otp') == input_otp:
        # Optionally, delete the OTP item after successful verification
        # to prevent reuse, if not relying on TTL for cleanup.
        # table.delete_item(Key={'userId': user_id})
        return {
            'statusCode': 200,
            'body': json.dumps({'verified': True, 'message': 'OTP verified successfully'})
        }

    return {
        'statusCode': 401, # HTTP 401 Unauthorized
        'body': json.dumps({'verified': False, 'error': 'Invalid OTP'})
    }
</code></pre>

                <div class="blog-post-image">
                    <img src="../img/lambda-function-editor.png" alt="AWS Lambda Function Editor showing send_otp.py and verify_otp.py">
                </div>
                <p class="blog-post-caption">Lambda functions deployed in AWS Console - The Code tab shows both send_otp.py and verify_otp.py files in the Lambda function editor, confirming successful deployment of our OTP service functions.</p>

                <h3>Step 2: Terraform Configuration</h3>
                <p>Prepare the following Terraform files in the top of your project.</p>
                
                <p>Using Terraform we can just code our complete infrastructure and it can be reproducible, auditable and versioned. The configuration gives everything that AWS needs like DynamoDB tables, lambda functions, least-privileged IAM roles, API Gateway endpoints, and the necessary inter-service connections.</p>

                <h4><code>main.tf</code></h4>
                <p>This file is used to configure all the AWS resources like the IAM roles and permissions that are needed. Note the way in which we are using random name to generate resource names and they would not conflict with each other in the event you are deploying more than one environment. The IAM policies have been founded on the principle of least privilege, the principle entails the granting of a given set of permissions as mandated by each Lambda function.</p>
<pre><code class="language-hcl">
provider "aws" {
  region = var.aws_region
}

# --- DynamoDB Table for OTPs ---
resource "aws_dynamodb_table" "otp_table" {
  name         = "OTPsTable-${random_id.suffix.hex}" # Unique table name
  billing_mode = "PAY_PER_REQUEST"
  hash_key     = "userId" # Primary key

  attribute {
    name = "userId" # Phone number or user identifier
    type = "S"      # String
  }

  # TTL (Time To Live) configuration to automatically delete expired OTPs
  ttl {
    attribute_name = "expirationTime" # Must match the attribute name in Lambda
    enabled        = true
  }

  tags = {
    Name        = "OTPStorageTable"
    Environment = "Production" # Or your environment
  }
}

# Generate a random suffix for unique resource naming
resource "random_id" "suffix" {
  byte_length = 4
}

# --- IAM Role and Policies for Lambda ---
resource "aws_iam_role" "lambda_exec_role" {
  name = "otp_lambda_exec_role-${random_id.suffix.hex}"

  assume_role_policy = jsonencode({
    Version = "2012-10-17",
    Statement = [{
      Action    = "sts:AssumeRole",
      Effect    = "Allow",
      Principal = { Service = "lambda.amazonaws.com" }
    }]
  })

  tags = {
    Name = "OTP Lambda Execution Role"
  }
}

# Basic Lambda execution policy (CloudWatch Logs)
resource "aws_iam_role_policy_attachment" "lambda_basic_exec_policy" {
  role       = aws_iam_role.lambda_exec_role.name
  policy_arn = "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
}

# Custom IAM policy for DynamoDB and SNS access
resource "aws_iam_policy" "lambda_custom_permissions_policy" {
  name        = "otp_lambda_permissions_policy-${random_id.suffix.hex}"
  description = "Policy for Lambda to access DynamoDB OTP table and publish to SNS"

  policy = jsonencode({
    Version = "2012-10-17",
    Statement = [
      {
        Effect   = "Allow",
        Action   = [
            "dynamodb:GetItem",
            "dynamodb:PutItem",
            "dynamodb:DeleteItem", # If you implement OTP deletion after verification
            "dynamodb:UpdateItem"  # If you need to update items
        ],
        Resource = aws_dynamodb_table.otp_table.arn
      },
      {
        Effect   = "Allow",
        Action   = ["sns:Publish"],
        Resource = "*" # Restrict this to specific SNS topics in production if possible
      }
    ]
  })
}

resource "aws_iam_role_policy_attachment" "lambda_custom_permissions_attachment" {
  role       = aws_iam_role.lambda_exec_role.name
  policy_arn = aws_iam_policy.lambda_custom_permissions_policy.arn
}

# --- Lambda Functions ---
# Package the lambda functions
data "archive_file" "lambda_zip" {
  type        = "zip"
  source_dir  = "${path.module}/lambda/"
  output_path = "${path.module}/lambda.zip"
}

resource "aws_lambda_function" "send_otp_lambda" {
  filename         = data.archive_file.lambda_zip.output_path
  function_name    = "sendOTPFunction-${random_id.suffix.hex}"
  role             = aws_iam_role.lambda_exec_role.arn
  handler          = "send_otp.lambda_handler" # Corresponds to filename.function_name
  runtime          = "python3.12"
  source_code_hash = data.archive_file.lambda_zip.output_base64sha256

  environment {
    variables = {
      OTP_TABLE = aws_dynamodb_table.otp_table.name
    }
  }

  tags = {
    Name = "SendOTP Lambda"
  }
}

resource "aws_lambda_function" "verify_otp_lambda" {
  filename         = data.archive_file.lambda_zip.output_path
  function_name    = "verifyOTPFunction-${random_id.suffix.hex}"
  role             = aws_iam_role.lambda_exec_role.arn
  handler          = "verify_otp.lambda_handler" # Corresponds to filename.function_name
  runtime          = "python3.12"
  source_code_hash = data.archive_file.lambda_zip.output_base64sha256

  environment {
    variables = {
      OTP_TABLE = aws_dynamodb_table.otp_table.name
    }
  }

  tags = {
    Name = "VerifyOTP Lambda"
  }
}

# --- API Gateway (HTTP API v2) ---
resource "aws_apigatewayv2_api" "otp_api" {
  name          = "OTPApi-${random_id.suffix.hex}"
  protocol_type = "HTTP"
  description   = "API Gateway for Serverless OTP Service"

  tags = {
    Name = "OTP Service API"
  }
}

resource "aws_apigatewayv2_stage" "default_stage" {
  api_id      = aws_apigatewayv2_api.otp_api.id
  name        = "$default" # Default stage
  auto_deploy = true      # Automatically deploy changes

  tags = {
    Name = "OTP API Default Stage"
  }
}

# API Gateway Integrations with Lambda
resource "aws_apigatewayv2_integration" "send_otp_integration" {
  api_id           = aws_apigatewayv2_api.otp_api.id
  integration_type = "AWS_PROXY" # For Lambda proxy integration
  integration_uri  = aws_lambda_function.send_otp_lambda.invoke_arn
  payload_format_version = "2.0" # For HTTP APIs
}

resource "aws_apigatewayv2_integration" "verify_otp_integration" {
  api_id           = aws_apigatewayv2_api.otp_api.id
  integration_type = "AWS_PROXY"
  integration_uri  = aws_lambda_function.verify_otp_lambda.invoke_arn
  payload_format_version = "2.0"
}

# API Gateway Routes
resource "aws_apigatewayv2_route" "send_otp_route" {
  api_id    = aws_apigatewayv2_api.otp_api.id
  route_key = "POST /send-otp" # Method and path
  target    = "integrations/${aws_apigatewayv2_integration.send_otp_integration.id}"
}

resource "aws_apigatewayv2_route" "verify_otp_route" {
  api_id    = aws_apigatewayv2_api.otp_api.id
  route_key = "POST /verify-otp"
  target    = "integrations/${aws_apigatewayv2_integration.verify_otp_integration.id}"
}

# Permissions for API Gateway to invoke Lambda functions
resource "aws_lambda_permission" "api_gw_send_otp_permission" {
  statement_id  = "AllowAPIGatewayInvokeSendOTP"
  action        = "lambda:InvokeFunction"
  function_name = aws_lambda_function.send_otp_lambda.function_name
  principal     = "apigateway.amazonaws.com"
  # Source ARN restricts which API Gateway can invoke this Lambda
  source_arn    = "${aws_apigatewayv2_api.otp_api.execution_arn}/*/*"
}

resource "aws_lambda_permission" "api_gw_verify_otp_permission" {
  statement_id  = "AllowAPIGatewayInvokeVerifyOTP"
  action        = "lambda:InvokeFunction"
  function_name = aws_lambda_function.verify_otp_lambda.function_name
  principal     = "apigateway.amazonaws.com"
  source_arn    = "${aws_apigatewayv2_api.otp_api.execution_arn}/*/*"
}

</code></pre>

                <h4><code>variables.tf</code></h4>
<pre><code class="language-hcl">
variable "aws_region" {
  description = "The AWS region to deploy resources into."
  type        = string
  default     = "us-east-1"
}
</code></pre>

                <h4><code>outputs.tf</code></h4>
<pre><code class="language-hcl">
output "api_endpoint" {
  description = "The base URL endpoint for the OTP API."
  value       = aws_apigatewayv2_api.otp_api.api_endpoint
}

output "send_otp_endpoint" {
  description = "Full URL to the /send-otp endpoint."
  value       = "${aws_apigatewayv2_api.otp_api.api_endpoint}/send-otp"
}

output "verify_otp_endpoint" {
  description = "Full URL to the /verify-otp endpoint."
  value       = "${aws_apigatewayv2_api.otp_api.api_endpoint}/verify-otp"
}

output "otp_table_name" {
  description = "Name of the DynamoDB table used for storing OTPs."
  value       = aws_dynamodb_table.otp_table.name
}
</code></pre>

                <h3>Step 3: Deploy the Stack</h3>
                <p>Make sure that your Lambda code of operation is found in the lambda folder before deploying. Terraform configuration is able to zip this directory automatically using an archive file, data.</p>
                <ol>
                    <li>
                        <strong>Initialize Terraform:</strong>
                        <p>Enter this command in the first level of your project (initial directory with your <code>.tf</code> files):</p>
                        <pre><code>terraform init</code></pre>
                    </li>
                    <li>
                        <strong>Plan the deployment:</strong>
                        <p>This will demonstrate what will be created by Terraform.</p>
                        <pre><code>terraform plan</code></pre>
                    </li>
                    <li>
                        <strong>Introduction of Terraform configuration:</strong>
                        <p>This will provision the AWS account of resources. Certify by answering yes by typing it on the screen.</p>
                        <pre><code>terraform apply</code></pre>
                    </li>
                </ol>
                <p>Upon deployment, Terraform will provide the URLs of the endpoints of the API. You are now able to make POSTs to:</p>
                <ul>
                    <li><code>https://<api-id>.execute-api.<region>.amazonaws.com/send-otp</code>
                        <br>Request Body: <code>{ "userId": "+11234567890" }</code> (organize E.164 formatted phone number)
                    </li>
                    <li><code>https://<api-id>.execute-api.<region>.amazonaws.com/verify-otp</code>
                        <br>Request Body: <code>{ "userId": "+11234567890", "otp": "123456" }</code>
                    </li>
                </ul>
                 <p>In order to clean up and destroy all created resources, do:</p>
                 <pre><code>terraform destroy</code></pre>

                <h2>Testing and Validation</h2>
                <p>Ensuring your OTP service is later tested properly before production deployment entails that you take this test into consideration. The following are some of the methods of testing your endpoints:</p>
                
                <h3>Using cURL (Command Line)</h3>
                <p>Upon the execution of the Terraform, the output format will contain API endpoint URLs. Test using cURL, using the following URLs:</p>
                
                <h4>Send OTP Request</h4>
                <pre><code>curl -X POST https://your-api-id.execute-api.us-east-1.amazonaws.com/send-otp \<br/>  -H "Content-Type: application/json" \<br/>  -d '{"userId": "+11234567890"}'</code></pre>
                <p><strong>Expected Response:</strong></p>
                <pre><code>{"message": "OTP sent successfully"}</code></pre>
                <p>You will be expected to get an SMS containing the 6-digit OTP in the given phone number.</p>
                
                <h4>Verify OTP Request</h4>
                <pre><code>curl -X POST https://your-api-id.execute-api.us-east-1.amazonaws.com/verify-otp \<br/>  -H "Content-Type: application/json" \<br/>  -d '{"userId": "+11234567890", "otp": "123456"}'</code></pre>
                <p><strong>Expected Response (Valid OTP):</strong></p>
                <pre><code>{"verified": true, "message": "OTP verified successfully"}</code></pre>
                <p><strong>Expected Response (Invalid OTP):</strong></p>
                <pre><code>{"verified": false, "error": "Invalid OTP"}</code></pre>
                
                <h3>Using Postman (GUI Tool)</h3>
                <p>Postman is also simpler to interface:</p>
                <ol>
                    <li>Insert a new POST message in Postman.</li>
                    <li>Replace the URL with an otp endpoint of the same.</li>
                    <li>On the tab of the body, select the option of raw and format of the data to be in the JSON format.</li>
                    <li>Make POST request: <code>{"userId": "+11234567890"}</code></li>
                    <li>Press the button send and have the response.</li>
                    <li>Similarly, we should do the same with <code>/verify-otp</code> endpoint with received OTP.</li>
                </ol>
                
                <h3>Testing Edge Cases</h3>
                <p>General test on various situations should be carried out:</p>
                <ul>
                    <li><strong>Un-Valid Phone number format:</strong> This is a test of incorrect phone numbers in order to determine the warning messages.</li>
                    <li><strong>Expired OTP:</strong> Wait 5 minutes after an OTP has been generated and verify (this must fail with the error of OTP expired)</li>
                    <li><strong>Missing Parameters:</strong> Check the error handling, submit requests with missing parameters.</li>
                    <li><strong>Bad JSON:</strong> This is used to test the error responses in parsing by running bad JSON.</li>
                    <li><strong>Non-Existent User:</strong> Trying to check OTP of a userId which does not request OTP non-existent user.</li>
                </ul>

                <h2>Best Practices and Error Handling</h2>
                <p>Error handling, performance optimization and security have to be taken into consideration carefully when building production-ready serverless applications. These are some of the key considerations:</p>
                
                <h3>End to end Error Management</h3>
                
                <h4>Patterns of Lambda Functions Mistakes</h4>
                <p>We are implementing many levels of error management:</p>
                <ul>
                    <li><strong>Input Checking:</strong> Incoming information must always be checked before its processing. Check on the presence of required fields, right data types and the expected formats (e.g., E.164 phone format).</li>
                    <li><strong>Try-Catch Blocks:</strong> AWS service calls should be surrounded by exception handlers to handle network problems, access control errors or access control throttling.</li>
                    <li><strong>Educational Error Messages:</strong> Provide meaningful error messages that can be used to diagnose the problem without disclosing confidential system information.</li>
                    <li><strong>Proper HTTP Status codes:</strong> HTTP semantic status codes (400 in the case of bad requests, 401 in the case of authentication failures, 404 not found, 500 server errors).</li>
                </ul>
                
                <h4>Retry Logic and Idempotency</h4>
                <p>Add mechanism of retries in case of transient failures:</p>
                <ul>
                    <li><strong>Exponential Backoff:</strong> Backoff-At least when retries are applied to failed operations, exponential downplaying is used to prevent overloading downstream services.</li>
                    <li><strong>Idempotence Operations:</strong> Design is regarded to be the same as when calling functions with inputs which then result in the same outcome without any undesired side effects. In the service of OTP, you can consider relating a timestamp or request id to avoid duplicate transmission of SMS.</li>
                    <li><strong>Dead Letter Queues (DLQ):</strong> Enable Lambda DLQs to receive gained events, which can be analysed or reprocessed.</li>
                </ul>
                
                <h3>Managing Cold Starts</h3>
                <p>The cold starts are observed when Lambda creates a fresh execution environment, which delays returns more on the first call. The mitigation measures are:</p>
                <ul>
                    <li><strong>Warm aviation:</strong> Warm Lambda instances Warm Lambda instances, provide predictable performance by configuring provisioned concurrency (note: more expensive).</li>
                    <li><strong>Minimize the Size of the Package:</strong> Minimize the size of the deployment package by eliminating unnecessary dependency. Smaller packages minimize the time of initiating.</li>
                    <li><strong>Code Optimization:</strong> Extraction: Extract Initialize Keeps uninitiating code outside the handler function to execute it on a per-container-family basis as opposed to a per-invocation-family basis.</li>
                    <li><strong>Connection Pooling:</strong> Recycle database and AWS SDK clients between calls by declaring them outside the handler.</li>
                    <li><strong>Select Suitable Memory:</strong> Increased memory allocation leaves more CPU, capable of cutting on start-up time.</li>
                </ul>
                
                <p><strong>Example of optimized Lambda structure:</strong></p>
                <pre><code># Initialize clients outside handler (runs once per container)<br/>dynamodb = boto3.resource('dynamodb')<br/>sns = boto3.client('sns')<br/>table = dynamodb.Table(os.environ['OTP_TABLE'])<br/><br/>def lambda_handler(event, context):<br/>    # Handler logic here - reuses initialized clients</code></pre>
                
                <h3>Security Best Practices</h3>
                
                <h4>IAM Policies- Least Privilege Principle</h4>
                <p>Provide access to a minimum number of permissions:</p>
                <ul>
                    <li><strong>Resource-Specific Policies resource-specific policies:</strong> The Terraform configuration leaves DynamoDB access on all tables, but only to OTP table ARN.</li>
                    <li><strong>Action-Specific Permissions:</strong> This should have action-specific permissions, e.g. only what is necessary (GetItem, PutItem) as opposed to sets of wildcards such as <code>dynamodb:*</code>.</li>
                    <li><strong>SNS Restrictions:</strong> Limit SNS publish to particular topics or exchange number patterns rather than <code>Resource: "*"</code>.</li>
                </ul>
                
                <h4>API Security</h4>
                <p>Improve the API Gateway insecurity:</p>
                <ul>
                    <li><strong>API keys:</strong> API keys are also required on each request to ensure that it is not accessed without authorization.</li>
                    <li><strong>Usage Plans and Throttling:</strong> Set rate limits to avoid abuse (e.g. 10 requests per minute per user).</li>
                    <li><strong>AWS WAF Integration:</strong> Instance AWS Web Application Firewall to mitigate most common attacks (SQL injection or DDoS).</li>
                    <li><strong>Request Validation:</strong> API Gateway request validation to deny the malformed requests to Lambda.</li>
                    <li><strong>CORS Set up:</strong> In case of a web front, set up CORS appropriately to just allow trusted domains.</li>
                </ul>
                
                <h4>Data Protection</h4>
                <ul>
                    <li><strong>Encryption at Rest:</strong> DynamoDB encryption is a feature that encrypts any stored OTPs (keys are managed automatically by AWS).</li>
                    <li><strong>Encryption in Transit:</strong> API Gateway is by default configured to use HTTPS, which means that the data is encrypted on the way.</li>
                    <li><strong>Short TTL Values:</strong> OTP expiration times should be as short as possible (less than 5 minutes) to reduce exposure times.</li>
                    <li><strong>Generation of OTP Cryptographically Secure:</strong> Use of Cryptographically secure random number generators. The <code>random.SystemRandom()</code> of Python is more production-safe than <code>random.randint()</code> is.</li>
                </ul>
                
                <h3>Logging and Debugging</h3>
                
                <h4>CloudWatch Integration</h4>
                <p>The logs are automatically transferred to CloudWatch by the Lambda. Improve observability using the following practices:</p>
                <ul>
                    <li><strong>Structured Logging:</strong> Use of JSON structure to enable easy parsing and querying of the log events.</li>
                    <li><strong>Contextual Information:</strong> Log entries should contain request identifiers, user identifiers, and time to correlate them.</li>
                    <li><strong>Log Levels:</strong> It is advisable to use the right levels ( INFO, warning, error) to filter logs.</li>
                    <li><strong>Avoid Logging Sensitive Data:</strong> OTPs and phone numbers should never be logged in any production.</li>
                </ul>
                
                <p><strong>Example structured logging:</strong></p>
                <pre><code>import json<br/>import logging<br/><br/>logger = logging.getLogger()<br/>logger.setLevel(logging.INFO)<br/><br/>def lambda_handler(event, context):<br/>    logger.info(json.dumps({<br/>        'event': 'otp_generation',<br/>        'request_id': context.request_id,<br/>        'status': 'started'<br/>    }))</code></pre>
                
                <h4>AWS X-Ray distributed tracing</h4>
                <p>Trace service requests in AWS X-Ray:</p>
                <ul>
                    <li><strong>end-to-end-visibility:</strong> Monitor API Gateway to Lambda to DynamoDB and SNS requests.</li>
                    <li><strong>Performance Bottlenecks:</strong> Fast operations- identify the slowness and optimize them.</li>
                    <li><strong>Error Analysis:</strong> Visualize request chain errors.</li>
                </ul>
                
                <p>Enables X-Ray in Terraform: Add to Lambda configuration:</p>
                <pre><code>tracing_config {<br/>  mode = "Active"<br/>}</code></pre>
                
                <h3>Cost Optimization</h3>
                <ul>
                    <li><strong>Right-Size Memory:</strong> Lambda memory influences prices. You can start with 128MB and upgrade depending on the performance tests.</li>
                    <li><strong>Monitor Invocations:</strong> CloudWatch metrics can be used to monitor invocation counts and detect unusual spikes of usage.</li>
                    <li><strong>DynamoDB On-Demand vs Provisioned:</strong> In unpredictable workloads, an on-demand pricing (which we have implemented) may be cheaper.</li>
                    <li><strong>SNS Cost Management:</strong> The cost of SMS differs by the country. Tracking SNS costs and rate limiting to eliminate abuse.</li>
                    <li><strong>Create Budget Scripts:</strong> Enabling AWS Budgets to notify you when your spending is beyond certain limits.</li>
                </ul>
                
                <h3>Production Checklist Ready Checklist</h3>
                <p>Before going to production, make sure that you have tackled:</p>
                <ul>
                    <li>✓ Installed error recovery and retries.</li>
                    <li>✓ Error and throttling CloudWatch alarm configuration.</li>
                    <li>✓ Encleaned AWS X-Ray distributed tracing.</li>
                    <li>✓ Applied least-privilege IAM is using the least-privilege policies.</li>
                    <li>✓ Install API rate limiting and throttling.</li>
                    <li>✓ Point-in-Time DynamoDB Disaster recovery.</li>
                    <li>✓ Lambda Scale: Reserved concurrency was on enabled Lamps to avoid runaway costs.</li>
                    <li>✓ Tested every possible error (expired OTPs, broken inputs, network errors).</li>
                    <li>✓ Install surveillance boards and notifications.</li>
                    <li>✓ Published API endpoints and error codes.</li>
                    <li>✓ Carried out load testing in order to test the behavior of auto-scaling.</li>
                </ul>

                <h2>Security Concerns and Sophisticated Best Practices</h2>
                
                <p>A production OTP service development demands to handle essential security and cost issues that will pose a major challenge to the reliability and cost of your application.</p>

                <h3>SMS Cost Management and Prevention</h3>
                
                <p>The charges charged through the Amazon SNS in terms of delivering SMS depend strongly on the destination country. Unless there are proper controls, it is possible to incur unexpected costs due to malicious actors or bugs.</p>

                <h4>SMS Pricing Reality Check</h4>
                <ul>
                    <li><strong>United States:</strong> $0.00645 cents/SMS (quite cheap)</li>
                    <li><strong>India:</strong> $0.00425 per SMS</li>
                    <li><strong>United Kingdom:</strong> $0.04290 /SMS (10 times higher)</li>
                    <li><strong>Germany:</strong> $0.07240 per SMS</li>
                    <li><strong>Kuwait:</strong> $0.11550 per SMS (27x US cost)</li>
                </ul>

                <p><strong>Scenario of Cost:</strong> It would be costs you $1,155 in a minute just in minutes, in case, an attacker sent 10,000 messages to the Kuwait numbers using SMS.</p>

                <h4>Implementing Rate Limiting</h4>
                <p>Install DynamoDB monitoring to avoid spamming via SMS:</p>

                <pre><code>import time

def lambda_handler(event, context):
    body = json.loads(event.get('body', '{}'))
    user_id = body.get('userId')
    
    # Check rate limit: max 3 OTPs per phone number per hour
    rate_limit_key = f"rate_limit_{user_id}"
    
    try:
        response = table.get_item(Key={'userId': rate_limit_key})
        item = response.get('Item')
        
        if item:
            attempts = item.get('attempts', 0)
            last_reset = item.get('last_reset', 0)
            current_time = int(time.time())
            
            # Reset counter every hour
            if current_time - last_reset > 3600:
                attempts = 0
                last_reset = current_time
            
            if attempts >= 3:
                return {
                    'statusCode': 429,  # Too Many Requests
                    'body': json.dumps({
                        'error': 'Rate limit exceeded',
                        'message': 'Maximum 3 OTP requests per hour',
                        'retry_after': 3600 - (current_time - last_reset)
                    })
                }
            
            # Increment attempt counter
            table.put_item(Item={
                'userId': rate_limit_key,
                'attempts': attempts + 1,
                'last_reset': last_reset,
                'expirationTime': current_time + 3600
            })
        else:
            # First attempt
            table.put_item(Item={
                'userId': rate_limit_key,
                'attempts': 1,
                'last_reset': int(time.time()),
                'expirationTime': int(time.time()) + 3600
            })
    
    except Exception as e:
        print(f"Rate limiting error: {e}")
        # Fail closed - deny request if rate limiting fails
        return {
            'statusCode': 503,
            'body': json.dumps({'error': 'Service temporarily unavailable'})
        }
    
    # Continue with normal OTP generation
    otp = str(random.randint(100000, 999999))
    # ... rest of the code</code></pre>

                <h4>Geographic SMS Restrictions</h4>
                <p>Restrict SMS delivery to approved countries to manage costs:</p>

                <pre><code>import phonenumbers

ALLOWED_COUNTRY_CODES = ['US', 'IN', 'CA', 'AU']  # Define allowed countries

def validate_phone_number(phone_number):
    """Validate phone number format and country"""
    try:
        parsed = phonenumbers.parse(phone_number, None)
        
        if not phonenumbers.is_valid_number(parsed):
            return False, "Invalid phone number"
        
        country_code = phonenumbers.region_code_for_number(parsed)
        
        if country_code not in ALLOWED_COUNTRY_CODES:
            return False, f"SMS not supported for country: {country_code}"
        
        return True, None
    
    except phonenumbers.NumberParseException:
        return False, "Invalid phone number format"

def lambda_handler(event, context):
    body = json.loads(event.get('body', '{}'))
    user_id = body.get('userId')
    
    # Validate phone number and country
    is_valid, error_message = validate_phone_number(user_id)
    
    if not is_valid:
        return {
            'statusCode': 400,
            'body': json.dumps({
                'error': error_message,
                'supported_countries': ALLOWED_COUNTRY_CODES
            })
        }
    
    # Continue with OTP generation...</code></pre>

                <h4>Cost Monitoring Alarms</h4>
                <p>Set up CloudWatch billing alarms for SNS spending:</p>

                <pre><code>Resources:
  SNSCostAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: HighSNSCosts
      AlarmDescription: Alert when SNS costs exceed threshold
      MetricName: EstimatedCharges
      Namespace: AWS/Billing
      Statistic: Maximum
      Period: 21600  # 6 hours
      EvaluationPeriods: 1
      Threshold: 50.0  # Alert at $50
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: ServiceName
          Value: AmazonSNS
      AlarmActions:
        - !Ref AlertSNSTopic</code></pre>

                <h3>OTP Retry Limits and Security</h3>

                <p>Implement verification attempt limits to prevent brute-force attacks:</p>

                <h4>Track Failed Verification Attempts</h4>
                <pre><code>def lambda_handler(event, context):
    body = json.loads(event.get('body', '{}'))
    user_id = body.get('userId')
    input_otp = body.get('otp')
    
    # Track verification attempts
    attempt_key = f"verify_attempts_{user_id}"
    
    try:
        attempt_record = table.get_item(Key={'userId': attempt_key})
        
        if attempt_record.get('Item'):
            failed_attempts = attempt_record['Item'].get('failed_attempts', 0)
            
            # Lock account after 5 failed attempts
            if failed_attempts >= 5:
                return {
                    'statusCode': 403,
                    'body': json.dumps({
                        'verified': False,
                        'error': 'Account temporarily locked',
                        'message': 'Too many failed attempts. Request new OTP in 15 minutes.'
                    })
                }
    
    except Exception as e:
        print(f"Error checking attempts: {e}")
    
    # Get stored OTP
    response = table.get_item(Key={'userId': user_id})
    item = response.get('Item')
    
    if not item:
        # Increment failed attempts
        increment_failed_attempts(user_id, attempt_key)
        return {
            'statusCode': 404,
            'body': json.dumps({
                'verified': False,
                'error': 'OTP not found or expired'
            })
        }
    
    # Check expiration
    if int(time.time()) > item.get('expirationTime', 0):
        # Don't increment attempts for expired OTPs
        return {
            'statusCode': 410,
            'body': json.dumps({
                'verified': False,
                'error': 'OTP expired',
                'message': 'Request a new OTP'
            })
        }
    
    # Verify OTP
    if item.get('otp') == input_otp:
        # Success - clear attempt counter and delete OTP
        table.delete_item(Key={'userId': attempt_key})
        table.delete_item(Key={'userId': user_id})
        
        return {
            'statusCode': 200,
            'body': json.dumps({
                'verified': True,
                'message': 'OTP verified successfully'
            })
        }
    
    # Failed verification - increment counter
    increment_failed_attempts(user_id, attempt_key)
    
    return {
        'statusCode': 401,
        'body': json.dumps({
            'verified': False,
            'error': 'Invalid OTP',
            'attempts_remaining': 5 - get_failed_attempts(user_id, attempt_key)
        })
    }

def increment_failed_attempts(user_id, attempt_key):
    """Increment failed verification attempts"""
    try:
        current_attempts = get_failed_attempts(user_id, attempt_key)
        
        table.put_item(Item={
            'userId': attempt_key,
            'failed_attempts': current_attempts + 1,
            'expirationTime': int(time.time()) + 900  # 15 min lockout
        })
    except Exception as e:
        print(f"Error incrementing attempts: {e}")

def get_failed_attempts(user_id, attempt_key):
    """Get current failed attempt count"""
    try:
        response = table.get_item(Key={'userId': attempt_key})
        return response.get('Item', {}).get('failed_attempts', 0)
    except:
        return 0</code></pre>

                <h3>Additional Security Hardening</h3>

                <h4>1. OTP Complexity and Entropy</h4>
                <p>Use cryptographically secure random number generation:</p>
                <pre><code>import secrets

# Instead of: otp = str(random.randint(100000, 999999))
# Use:
otp = str(secrets.randbelow(900000) + 100000)  # Cryptographically secure</code></pre>

                <h4>2. Phone Number Validation</h4>
                <p>Prevent attacks using invalid or premium-rate numbers:</p>
                <ul>
                    <li>Validate E.164 format: +[country code][number]</li>
                    <li>Block premium-rate prefixes</li>
                    <li>Implement allowlist for trusted number ranges</li>
                    <li>Verify number isn't VoIP or disposable</li>
                </ul>

                <h4>3. Request Origin Validation</h4>
                <p>Implement CAPTCHA or challenge tokens to prevent automated abuse:</p>
                <pre><code># Verify reCAPTCHA token before sending OTP
def verify_recaptcha(token):
    """Verify Google reCAPTCHA token"""
    import requests
    
    secret_key = os.environ['RECAPTCHA_SECRET']
    
    response = requests.post(
        'https://www.google.com/recaptcha/api/siteverify',
        data={
            'secret': secret_key,
            'response': token
        }
    )
    
    result = response.json()
    return result.get('success', False) and result.get('score', 0) > 0.5</code></pre>

                <h4>4. Honeypot Fields</h4>
                <p>Add hidden fields to detect bot submissions:</p>
                <pre><code>def lambda_handler(event, context):
    body = json.loads(event.get('body', '{}'))
    
    # Check honeypot field (should be empty)
    if body.get('website') or body.get('url'):
        # Likely bot - fail silently
        return {
            'statusCode': 200,
            'body': json.dumps({'message': 'OTP sent successfully'})
        }
    
    # Continue with normal processing...</code></pre>

                <h2>Conclusion</h2>
                <p>With Terraform, you have managed to design and deploy a scalable, serverless, and secure system of delivering OTP. This design operates through exposing the endpoints on AWS API Gateway, a business logic on AWS Lambda, an SMS sending service on Amazon SNS, and a persistent storage of OTP on auto-expiry on Amazon DynamoDB. The entire infrastructure is code managed; it is repeatable, versionable, and auditable.</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h3>Samir Adhikari</h3>
                    <p>A blog dedicated to sharing AWS insights, DevOps practices, and cloud solution strategies.</p>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/blog.html">Blog</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Categories</h4>
                    <ul>
                        <li><a href="#">AWS</a></li>
                        <li><a href="#">DevOps</a></li>
                        <li><a href="#">Serverless</a></li>
                        <li><a href="#">Terraform</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Contact</h4>
                    <ul>
                        <li><a href="mailto:samir.adhhh@example.com">samir.adhhh@gmail.com</a></li>
                        <li><a href="tel:+1234567890">9861762422</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-divider"></div>
            <div class="footer-bottom">
                <div class="copyright">© 2025 Samir Adhikari. All rights reserved.</div>
                <div class="footer-social">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to top button -->
    <a href="#" class="back-to-top" id="backToTopBtn" aria-label="Back to top">
        <i class="fas fa-arrow-up"></i>
    </a>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const checkbox = document.getElementById('checkbox');
            const themeOverlay = document.getElementById('themeOverlay');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

            function applyThemeTransition() {
                if (themeOverlay) {
                    themeOverlay.style.opacity = '1';
                    // Ensure display is block before starting transition
                    // but only if it's not already visible (to avoid flicker on load)
                    if (getComputedStyle(themeOverlay).display === 'none') {
                         themeOverlay.style.display = 'block';
                    }
                    setTimeout(() => {
                        themeOverlay.style.opacity = '0';
                        setTimeout(() => {
                            themeOverlay.style.display = 'none';
                        }, 300); // Match transition duration
                    }, 10); // Short delay to allow CSS to apply
                }
            }

            function setTheme(theme, manualSwitch = false) {
                applyThemeTransition();
                document.documentElement.setAttribute('data-theme', theme);
                if (manualSwitch) { // Only set forced if user manually toggled
                    document.documentElement.setAttribute('data-theme-forced', theme);
                }
                localStorage.setItem('theme', theme);
                if (checkbox) {
                    checkbox.checked = theme === 'dark';
                }
            }

            const storedTheme = localStorage.getItem('theme');
            const forcedTheme = document.documentElement.getAttribute('data-theme-forced');

            if (storedTheme) {
                setTheme(storedTheme);
            } else if (!forcedTheme && prefersDarkScheme.matches) {
                setTheme('dark');
            } else { // Default to light if nothing else set
                setTheme('light');
            }


            if (checkbox) {
                checkbox.addEventListener('change', () => {
                    const newTheme = checkbox.checked ? 'dark' : 'light';
                    setTheme(newTheme, true); // True for manual switch
                });
            }
            
            // Listen for OS theme changes if no theme explicitly set by user
            prefersDarkScheme.addEventListener('change', (e) => {
                // Only change if no theme has been manually forced by user toggle
                if (!document.documentElement.getAttribute('data-theme-forced')) {
                    setTheme(e.matches ? 'dark' : 'light');
                }
            });


             // --- Back to Top Button ---
            const backToTopBtn = document.getElementById('backToTopBtn');
            if (backToTopBtn) {
                window.addEventListener('scroll', () => {
                    if (window.pageYOffset > 300) {
                        backToTopBtn.classList.add('visible');
                    } else {
                        backToTopBtn.classList.remove('visible');
                    }
                });

                backToTopBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }

            // --- Mobile Menu ---
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');

            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', () => {
                    const isActive = mobileMenu.classList.toggle('active');
                    mobileMenuBtn.setAttribute('aria-expanded', isActive);
                });

                // Close mobile menu when a link is clicked (optional)
                mobileMenu.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenu.classList.remove('active');
                        mobileMenuBtn.setAttribute('aria-expanded', 'false');
                    });
                });
            }
            
            // --- Image Lightbox ---
            const blogImages = document.querySelectorAll('.blog-post-image img');
            
            // Create lightbox modal
            const lightboxModal = document.createElement('div');
            lightboxModal.className = 'lightbox-modal';
            lightboxModal.innerHTML = `
                <span class="lightbox-close">&times;</span>
                <div class="lightbox-content">
                    <img src="" alt="">
                </div>
            `;
            document.body.appendChild(lightboxModal);
            
            const lightboxImg = lightboxModal.querySelector('img');
            const closeBtn = lightboxModal.querySelector('.lightbox-close');
            
            // Add click event to all blog images
            blogImages.forEach(img => {
                img.addEventListener('click', () => {
                    lightboxImg.src = img.src;
                    lightboxImg.alt = img.alt;
                    lightboxModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
            });
            
            // Close lightbox
            const closeLightbox = () => {
                lightboxModal.classList.remove('active');
                document.body.style.overflow = '';
            };
            
            closeBtn.addEventListener('click', closeLightbox);
            lightboxModal.addEventListener('click', (e) => {
                if (e.target === lightboxModal) {
                    closeLightbox();
                }
            });
            
            // Close on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && lightboxModal.classList.contains('active')) {
                    closeLightbox();
                }
            });
        });
    </script>
</body>
</html>